Running your cluster in a restricted network without direct internet connectivity is possible by installing the cluster from a mirrored set of {product-title} container images in a private registry. This registry must be running at all times as long as the cluster is running. See the [Prerequisites](../../installing/disconnected_install/installing-mirroring-disconnected.xml#prerequisites_installing-mirroring-disconnected) section for more information.

You can use the oc-mirror OpenShift CLI (`oc`) plug-in to mirror images to a mirror registry in your fully or partially disconnected environments. You must run oc-mirror from a system with internet connectivity in order to download the required images from the official Red Hat registries.

The following steps outline the high-level workflow on how to use the oc-mirror plug-in to mirror images to a mirror registry:

1.  Create an image set configuration file.

2.  Mirror the image set to the mirror registry by using one of the following methods:

    -   Mirror an image set directly to the mirror registry.

    -   Mirror an image set to disk, transfer the image set to the target environment, then upload the image set to the target mirror registry.

3.  Install the `ImageContentSourcePolicy` and `CatalogSource` resources that were generated by oc-mirror into the cluster.

4.  Repeat these steps to update your mirror registry as necessary.

# About the oc-mirror plug-in

You can use the oc-mirror OpenShift CLI (`oc`) plug-in to mirror all required {product-title} content and other images to your mirror registry by using a single tool. It provides the following features:

-   Provides a centralized method to mirror {product-title} releases, Operators, helm charts, and other images.

-   Maintains update paths for {product-title} and Operators.

-   Uses a declarative image set configuration file to include only the {product-title} releases, Operators, and images that your cluster needs.

-   Performs incremental mirroring, which reduces the size of future image sets.

-   Prunes images from the target mirror registry that were excluded from the image set configuration since the previous execution.

-   Optionally generates supporting artifacts for OpenShift Update Service (OSUS) usage.

When using the oc-mirror plug-in, you specify which content to mirror in an image set configuration file. In this YAML file, you can fine-tune the configuration to only include the {product-title} releases and Operators that your cluster needs. This reduces the amount of data that you need to download and transfer. The oc-mirror plug-in can also mirror arbitrary helm charts and additional container images to assist users in seamlessly synchronizing their workloads onto mirror registries.

The first time you run the oc-mirror plug-in, it populates your mirror registry with the required content to perform your disconnected cluster installation. In order for your disconnected cluster to continue receiving updates, you must keep your mirror registry updated. To update your mirror registry, you run the oc-mirror plug-in using the same configuration as the first time you ran it. The oc-mirror plug-in references the metadata from the storage backend and only downloads what has been released since the last time you ran the tool. This provides update paths for {product-title} and Operators and performs dependency resolution as required.

When using the oc-mirror CLI plug-in to populate a mirror registry, any further updates to the mirror registry must be made using the oc-mirror tool.

# About the mirror registry

You can mirror the images that are required for {product-title} installation and subsequent product updates to a container mirror registry that supports [Docker v2-2](https://docs.docker.com/registry/spec/manifest-v2-2), such as Red Hat Quay. If you do not have access to a large-scale container registry, you can use the *mirror registry for Red Hat OpenShift*, which is a small-scale container registry included with {product-title} subscriptions.

Regardless of your chosen registry, the procedure to mirror content from Red Hat hosted sites on the internet to an isolated image registry is the same. After you mirror the content, you configure each cluster to retrieve this content from your mirror registry.

The internal registry of the {product-title} cluster cannot be used as the target registry because it does not support pushing without a tag, which is required during the mirroring process.

If choosing a container registry that is not the *mirror registry for Red Hat OpenShift*, it must be reachable by every machine in the clusters that you provision. If the registry is unreachable, installation, updating, or normal operations such as workload relocation might fail. For that reason, you must run mirror registries in a highly available way, and the mirror registries must at least match the production availability of your {product-title} clusters.

When you populate your mirror registry with {product-title} images, you can follow two scenarios. If you have a host that can access both the internet and your mirror registry, but not your cluster nodes, you can directly mirror the content from that machine. This process is referred to as *connected mirroring*. If you have no such host, you must mirror the images to a file system and then bring that host or removable media into your restricted environment. This process is referred to as *disconnected mirroring*.

For mirrored registries, to view the source of pulled images, you must review the `Trying to access` log entry in the CRI-O logs. Other methods to view the image pull source, such as using the `crictl images` command on a node, show the non-mirrored image name, even though the image is pulled from the mirrored location.

Red Hat does not test third party registries with {product-title}.

-   For information about viewing the CRI-O logs to view the image source, see [Viewing the image pull source](../../installing/validating-an-installation.xml#viewing-the-image-pull-source_validating-an-installation).

# Prerequisites

-   You must have a container image registry that supports [Docker v2-2](https://docs.docker.com/registry/spec/manifest-v2-2) in the location that will host the {product-title} cluster, such as Red Hat Quay.

    If you use Red Hat Quay, you must use version 3.6 or later with the oc-mirror plug-in. If you have an entitlement to Red Hat Quay, see the documentation on deploying Red Hat Quay [for proof-of-concept purposes](https://access.redhat.com/documentation/en-us/red_hat_quay/3.6/html/deploy_red_hat_quay_for_proof-of-concept_non-production_purposes/) or [by using the Quay Operator](https://access.redhat.com/documentation/en-us/red_hat_quay/3.6/html/deploy_red_hat_quay_on_openshift_with_the_quay_operator/). If you need additional assistance selecting and installing a registry, contact your sales representative or Red Hat Support.

    If you do not already have an existing solution for a container image registry, subscribers of {product-title} are provided a [mirror registry for Red Hat OpenShift](../../installing/disconnected_install/installing-mirroring-creating-registry.xml#installing-mirroring-creating-registry). The *mirror registry for Red Hat OpenShift* is included with your subscription and is a small-scale container registry that can be used to mirror the required container images of {product-title} in disconnected installations.

# Preparing your mirror hosts

Before you can use the oc-mirror plug-in to mirror images, you must install the plug-in and create a container image registry credentials file to allow the mirroring from Red Hat to your mirror.

## Installing the oc-mirror OpenShift CLI plug-in

To use the oc-mirror OpenShift CLI plug-in to mirror registry images, you must install the plug-in. If you are mirroring image sets in a fully disconnected environment, ensure that you install the oc-mirror plug-in on the host with internet access and the host in the disconnected environment with access to the mirror registry.

-   You have installed the OpenShift CLI (`oc`).

1.  Download the oc-mirror CLI plug-in.

    1.  Navigate to the [Downloads](https://console.redhat.com/openshift/downloads) page of the [OpenShift Cluster Manager](https://console.redhat.com/openshift).

    2.  Under the **OpenShift disconnected installation tools** section, click **Download** for **OpenShift Client (oc) mirror plugin** and save the file.

2.  Extract the archive:

        $ tar xvzf oc-mirror.tar.gz

3.  If necessary, update the plug-in file to be executable:

        $ chmod +x oc-mirror

    Do not rename the `oc-mirror` file.

4.  Install the oc-mirror CLI plug-in by placing the file in your `PATH`, for example, `/usr/local/bin`:

        $ sudo mv oc-mirror /usr/local/bin/.

-   Run `oc mirror help` to verify that the plug-in was successfully installed:

        $ oc mirror help

<!-- -->

-   [Installing and using CLI plug-ins](../../cli_reference/openshift_cli/extending-cli-plugins.xml#cli-installing-plugins_cli-extend-plugins)

## Configuring credentials that allow images to be mirrored

Create a container image registry credentials file that allows mirroring images from Red Hat to your mirror.

Do not use this image registry credentials file as the pull secret when you install a cluster. If you provide this file when you install cluster, all of the machines in the cluster will have write access to your mirror registry.

This process requires that you have write access to a container image registry on the mirror registry and adds the credentials to a registry pull secret.

-   You configured a mirror registry to use in your restricted network.

-   You identified an image repository location on your mirror registry to mirror images into.

-   You provisioned a mirror registry account that allows images to be uploaded to that image repository.

**Procedure**

Complete the following steps on the installation host:

1.  Download your `registry.redhat.io` [pull secret from the Red Hat OpenShift Cluster Manager](https://console.redhat.com/openshift/install/pull-secret).

2.  Make a copy of your pull secret in JSON format:

        $ cat ./pull-secret | jq . > <path>/<pull_secret_file_in_json> 

    -   Specify the path to the folder to store the pull secret in and a name for the JSON file that you create.

3.  Save the file either as `~/.docker/config.json` or `$XDG_RUNTIME_DIR/containers/auth.json`.

    The contents of the file resemble the following example:

        {
          "auths": {
            "cloud.openshift.com": {
              "auth": "b3BlbnNo...",
              "email": "you@example.com"
            },
            "quay.io": {
              "auth": "b3BlbnNo...",
              "email": "you@example.com"
            },
            "registry.connect.redhat.com": {
              "auth": "NTE3Njg5Nj...",
              "email": "you@example.com"
            },
            "registry.redhat.io": {
              "auth": "NTE3Njg5Nj...",
              "email": "you@example.com"
            }
          }
        }

4.  Generate the base64-encoded user name and password or token for your mirror registry:

        $ echo -n '<user_name>:<password>' | base64 -w0 
        BGVtbYk3ZHAtqXs=

    -   For `<user_name>` and `<password>`, specify the user name and password that you configured for your registry.

5.  Edit the JSON file and add a section that describes your registry to it:

          "auths": {
            "<mirror_registry>": { 
              "auth": "<credentials>", 
              "email": "you@example.com"
          },

    -   For `<mirror_registry>`, specify the registry domain name, and optionally the port, that your mirror registry uses to serve content. For example, `registry.example.com` or `registry.example.com:8443`

    -   For `<credentials>`, specify the base64-encoded user name and password for the mirror registry.

    The file resembles the following example:

        {
          "auths": {
            "registry.example.com": {
              "auth": "BGVtbYk3ZHAtqXs=",
              "email": "you@example.com"
            },
            "cloud.openshift.com": {
              "auth": "b3BlbnNo...",
              "email": "you@example.com"
            },
            "quay.io": {
              "auth": "b3BlbnNo...",
              "email": "you@example.com"
            },
            "registry.connect.redhat.com": {
              "auth": "NTE3Njg5Nj...",
              "email": "you@example.com"
            },
            "registry.redhat.io": {
              "auth": "NTE3Njg5Nj...",
              "email": "you@example.com"
            }
          }
        }

# Creating the image set configuration

Before you can use the oc-mirror plug-in to mirror image sets, you must create an image set configuration file. This image set configuration file defines which {product-title} releases, Operators, and other images to mirror, along with other configuration settings for the oc-mirror plug-in.

You must specify a storage backend in the image set configuration file. This storage backend can be a local directory or a registry that supports [Docker v2-2](https://docs.docker.com/registry/spec/manifest-v2-2). The oc-mirror plug-in stores metadata in this storage backend during image set creation.

Do not delete or modify the metadata that is generated by the oc-mirror plug-in. You must use the same storage backend every time you run the oc-mirror plug-in for the same mirror registry.

-   You have created a container image registry credentials file. For instructions, see *Configuring credentials that allow images to be mirrored*.

1.  Use the `oc mirror init` command to create a template for the image set configuration and save it to a file called `imageset-config.yaml`:

        $ oc mirror init --registry example.com/mirror/oc-mirror-metadata > imageset-config.yaml 

    -   Replace `example.com/mirror/oc-mirror-metadata` with the location of your registry for the storage backend.

2.  Edit the file and adjust the settings as necessary:

        kind: ImageSetConfiguration
        apiVersion: mirror.openshift.io/v1alpha2
        archiveSize: 4                                                      
        storageConfig:                                                      
          registry:
            imageURL: example.com/mirror/oc-mirror-metadata                 
            skipTLS: false
        mirror:
          platform:
            channels:
            - name: stable-4.11                                             
              type: ocp
            graph: true                                                     
          operators:
          - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.11  
            packages:
            - name: serverless-operator                                     
              channels:
              - name: stable
          additionalImages:
          - name: registry.redhat.io/ubi8/ubi:latest                        
          helm: {}

    -   Add `archiveSize` to set the maximum size, in GiB, of each file within the image set.

    -   Set the back-end location to save the image set metadata to. This location can be a registry or local directory. It is required to specify `storageConfig` values.

    -   Set the registry URL for the storage backend.

    -   Set the channel to retrieve the {product-title} images from.

    -   Add `graph: true` to generate the OpenShift Update Service (OSUS) graph image to allow for an improved cluster update experience when using the web console. For more information, see *About the OpenShift Update Service*.

    -   Set the Operator catalog to retrieve the {product-title} images from.

    -   Specify only certain Operator packages and channels to include in the image set. Remove this field to retrieve all packages in the catalog.

    -   Specify any additional images to include in image set.

    See *Image set configuration parameters* for the full list of parameters and *Image set configuration examples* for various mirroring use cases.

3.  Save the updated file.

    This image set configuration file is required by the `oc mirror` command when mirroring content.

-   [Image set configuration parameters](../../installing/disconnected_install/installing-mirroring-disconnected.xml#oc-mirror-imageset-config-params_installing-mirroring-disconnected)

-   [Image set configuration examples](../../installing/disconnected_install/installing-mirroring-disconnected.xml#oc-mirror-image-set-examples_installing-mirroring-disconnected)

-   [About the OpenShift Update Service](../../updating/updating-restricted-network-cluster.xml#update-service-overview_updating-restricted-network-cluster)

# Mirroring an image set to a mirror registry

You can use the oc-mirror CLI plug-in to mirror images to a mirror registry in a [partially disconnected environment](../../installing/disconnected_install/installing-mirroring-disconnected.xml#mirroring-image-set-partial) or in a [fully disconnected environment](../../installing/disconnected_install/installing-mirroring-disconnected.xml#mirroring-image-set-full).

These procedures assume that you already have your mirror registry set up.

## Mirroring an image set in a partially disconnected environment

In a partially disconnected environment, you can mirror an image set directly to the target mirror registry.

### Mirroring from mirror to mirror

You can use the oc-mirror plug-in to mirror an image set directly to a target mirror registry that is accessible during image set creation.

You are required to specify a storage backend in the image set configuration file. This storage backend can be a local directory or a Docker v2 registry. The oc-mirror plug-in stores metadata in this storage backend during image set creation.

Do not delete or modify the metadata that is generated by the oc-mirror plug-in. You must use the same storage backend every time you run the oc-mirror plug-in for the same mirror registry.

-   You have access to the internet to obtain the necessary container images.

-   You have installed the OpenShift CLI (`oc`).

-   You have installed the `oc-mirror` CLI plug-in.

-   You have created the image set configuration file.

<!-- -->

-   Run the `oc mirror` command to mirror the images from the specified image set configuration to a specified registry:

        $ oc mirror --config=./imageset-config.yaml \
          docker://registry.example:5000             

    -   Pass in the image set configuration file that was created. This procedure assumes that it is named `imageset-config.yaml`.

    -   Specify the registry to mirror the image set file to. The registry must start with `docker://`. If you specify a top-level namespace for the mirror registry, you must also use this same namespace on subsequent executions.

1.  Navigate into the `oc-mirror-workspace/` directory that was generated.

2.  Navigate into the results directory, for example, `results-1639608409/`.

3.  Verify that YAML files are present for the `ImageContentSourcePolicy` and `CatalogSource` resources.

-   Install the `ImageContentSourcePolicy` and `CatalogSource` resources into the cluster.

## Mirroring an image set in a fully disconnected environment

To mirror an image set in a fully disconnected environment, you must first [mirror the image set to disk](../../installing/disconnected_install/installing-mirroring-disconnected.xml#oc-mirror-mirror-to-disk_installing-mirroring-disconnected), then [mirror the image set file on disk to a mirror](../../installing/disconnected_install/installing-mirroring-disconnected.xml#oc-mirror-disk-to-mirror_installing-mirroring-disconnected).

### Mirroring from mirror to disk

You can use the oc-mirror plug-in to generate an image set and save the contents to disk. The generated image set can then be transferred to the disconnected environment and mirrored to the target registry.

Depending on the configuration specified in the image set configuration file, using oc-mirror to mirror images might download several hundreds of gigabytes of data to disk.

The initial image set download when you populate the mirror registry is often the largest. Because you only download the images that changed since the last time you ran the command, when you run the oc-mirror plug-in again, the generated image set is often smaller.

You are required to specify a storage backend in the image set configuration file. This storage backend can be a local directory or a docker v2 registry. The oc-mirror plug-in stores metadata in this storage backend during image set creation.

Do not delete or modify the metadata that is generated by the oc-mirror plug-in. You must use the same storage backend every time you run the oc-mirror plug-in for the same mirror registry.

-   You have access to the internet to obtain the necessary container images.

-   You have installed the OpenShift CLI (`oc`).

-   You have installed the `oc-mirror` CLI plug-in.

-   You have created the image set configuration file.

<!-- -->

-   Run the `oc mirror` command to mirror the images from the specified image set configuration to disk:

        $ oc mirror --config=./imageset-config.yaml \
          file://<path_to_output_directory>          

    -   Pass in the image set configuration file that was created. This procedure assumes that it is named `imageset-config.yaml`.

    -   Specify the target directory where you want to output the image set file. The target directory path must start with `file://`.

1.  Navigate to your output directory:

        $ cd <path_to_output_directory>

2.  Verify that an image set `.tar` file was created:

        $ ls

    **Example output**

        mirror_seq1_000000.tar

-   Transfer the image set .tar file to the disconnected environment.

### Mirroring from disk to mirror

You can use the oc-mirror plug-in to mirror the contents of a generated image set to the target mirror registry.

-   You have installed the OpenShift CLI (`oc`) in the disconnected environment.

-   You have installed the `oc-mirror` CLI plug-in in the disconnected environment.

-   You have generated the image set file by using the `oc mirror` command.

-   You have transferred the image set file to the disconnected environment.

<!-- -->

-   Run the `oc mirror` command to process the image set file on disk and mirror the contents to a target mirror registry:

        $ oc mirror --from=./mirror_seq1_000000.tar \
          docker://registry.example:5000             

    -   Pass in the image set .tar file to mirror, named `mirror_seq1_000000.tar` in this example. If an `archiveSize` value was specified in the image set configuration file, the image set might be broken up into multiple .tar files. In this situation, you can pass in a directory that contains the image set .tar files.

    -   Specify the registry to mirror the image set file to. The registry must start with `docker://`. If you specify a top-level namespace for the mirror registry, you must also use this same namespace on subsequent executions.

    This command updates the mirror registry with the image set and generates the `ImageContentSourcePolicy` and `CatalogSource` resources.

1.  Navigate into the `oc-mirror-workspace/` directory that was generated.

2.  Navigate into the results directory, for example, `results-1639608409/`.

3.  Verify that YAML files are present for the `ImageContentSourcePolicy` and `CatalogSource` resources.

-   Install the `ImageContentSourcePolicy` and `CatalogSource` resources into the cluster.

# Installing the ImageContentSourcePolicy and CatalogSource resources into the cluster

After you have mirrored your image set to the mirror registry, you must install the generated `ImageContentSourcePolicy` and `CatalogSource` resources into the cluster.

The `ImageContentSourcePolicy` resource associates the mirror registry with the source registry and redirects image pull requests from the online registries to the mirror registry. The `CatalogSource` resource is used by Operator Lifecycle Manager (OLM) to retrieve information about the available Operators in the mirror registry.

-   You have mirrored the image set to the registry mirror in the disconnected environment.

-   You have access to the cluster as a user with the `cluster-admin` role.

1.  Log in to the OpenShift CLI as a user with the `cluster-admin` role.

2.  Apply the YAML files from the results directory to the cluster:

        $ oc apply -f ./oc-mirror-workspace/results-1639608409/

<!-- -->

1.  Verify that the `ImageContentSourcePolicy` resources were successfully installed:

        $ oc get imagecontentsourcepolicy --all-namespaces

2.  Verify that the `CatalogSource` resources were successfully installed:

        $ oc get catalogsource --all-namespaces

# Keeping your mirror registry content updated

After your target mirror registry is populated with the initial image set, be sure to update it regularly so that it has the latest content. You can optionally set up a cron job, if possible, so that the mirror registry is updated on a regular basis.

Ensure that you update your image set configuration to add or remove {product-title} and Operator releases as necessary. Any images that are removed are pruned from the mirror registry.

## About updating your mirror registry content

When you run the oc-mirror plug-in again, it generates an image set that only contains new and updated images since the previous execution. Because it only pulls in the differences since the previous image set was created, the generated image set is often smaller and faster to process than the initial image set.

Generated image sets are sequential and must be pushed to the target mirror registry in order. You can derive the sequence number from the file name of the generated image set archive file.

**Adding new and updated images**

Depending on the settings in your image set configuration, future executions of oc-mirror can mirror additional new and updated images. Review the settings in your image set configuration to ensure that you are retrieving new versions as necessary. For example, you can set the minimum and maximum versions of Operators to mirror if you want to restrict to specific versions. Alternatively, you can set the minimum version as a starting point to mirror, but keep the version range open so you keep receiving new Operator versions on future executions of oc-mirror. Omitting any minimum or maximum version gives you the full version history of an Operator in a channel. Omitting explicitly named channels gives you all releases in all channels of the specified Operator. Omitting any named Operator gives you the entire catalog of all Operators and all their versions ever released.

All these constraints and conditions are evaluated against the publicly released content by Red Hat on every invocation of oc-mirror. This way, it automatically picks up new releases and entirely new Operators. Constraints can be specified by only listing a desired set of Operators, which will not automatically add other newly released Operators into the mirror set. You can also specify a particular release channel, which limits mirroring to just this channel and not any new channels that have been added. This is important for Operator products, such as Red Hat Quay, that use different release channels for their minor releases. Lastly, you can specify a maximum version of a particular Operator, which causes the tool to only mirror the specified version range so that you do not automatically get any newer releases past the maximum version mirrored. In all these cases, you must update the image set configuration file to broaden the scope of the mirroring of Operators to get other Operators, new channels, and newer versions of Operators to be available in your target registry.

It is recommended to align constraints like channel specification or version ranges with the release strategy that a particular Operator has chosen. For example, when the Operator uses a `stable` channel, you should restrict mirroring to that channel and potentially a minimum version to find the right balance between download volume and getting stable updates regularly. If the Operator chooses a release version channel scheme, for example `stable-3.7`, you should mirror all releases in that channel. This allows you to keep receiving patch versions of the Operator, for example `3.7.1`. You can also regularly adjust the image set configuration to add channels for new product releases, for example `stable-3.8`.

**Pruning images**

Images are pruned automatically from the target mirror registry if they are no longer included in the latest image set that was generated and mirrored. This allows you to easily manage and clean up unneeded content and reclaim storage resources.

If there are {product-title} releases or Operator versions that you no longer need, you can modify your image set configuration to exclude them, and they will be pruned from the mirror registry upon mirroring. This can be done by adjusting a minimum or maximum version range setting per Operator in the image set configuration file or by deleting the Operator from the list of Operators to mirror from the catalog. You can also remove entire Operator catalogs or entire {product-title} releases from the configuration file.

If there are no new or updated images to mirror, the excluded images are not pruned from the target mirror registry. Additionally, if an Operator publisher removes an Operator version from a channel, the removed versions are pruned from the target mirror registry.

## Updating your mirror registry content

After you publish the initial image set to the mirror registry, you can use the oc-mirror plug-in to keep your disconnected clusters updated.

Depending on your image set configuration, oc-mirror automatically detects newer releases of {product-title} and your selected Operators that have been released after you completed the inital mirror. It is recommended to run oc-mirror at regular intervals, for example in a nightly cron job, to receive product and security updates on a timely basis.

-   You have used the oc-mirror plug-in to mirror the initial image set to your mirror registry.

-   You have access to the storage backend that was used for the initial execution of the oc-mirror plug-in.

    You must use the same storage backend as the initial execution of oc-mirror for the same mirror registry. Do not delete or modify the metadata image that is generated by the oc-mirror plug-in.

1.  If necessary, update your image set configuration file to pick up new {product-title} and Operator versions. See *Image set configuration examples* for example mirroring use cases.

2.  Follow the same steps that you used to mirror your initial image set to the mirror registry. For instructions, see *Mirroring an image set in a partially disconnected environment* or *Mirroring an image set in a fully disconnected environment*.

    -   You must provide the same storage backend so that only a differential image set is created and mirrored.

    -   If you specified a top-level namespace for the mirror registry during the initial image set creation, then you must use this same namespace every time you run the oc-mirror plug-in for the same mirror registry.

3.  Install the `ImageContentSourcePolicy` and `CatalogSource` resources into the cluster.

-   [Image set configuration examples](../../installing/disconnected_install/installing-mirroring-disconnected.xml#oc-mirror-image-set-examples_installing-mirroring-disconnected)

-   [Mirroring an image set in a partially disconnected environment](../../installing/disconnected_install/installing-mirroring-disconnected.xml#mirroring-image-set-partial)

-   [Mirroring an image set in a fully disconnected environment](../../installing/disconnected_install/installing-mirroring-disconnected.xml#mirroring-image-set-full)

-   [Installing the ImageContentSourcePolicy and CatalogSource resources into the cluster](../../installing/disconnected_install/installing-mirroring-disconnected.xml#oc-mirror-updating-cluster-manifests_installing-mirroring-disconnected)

# Performing a dry run

You can use oc-mirror to perform a dry run, without actually mirroring any images. This allows you to review the list of images that would be mirrored, as well as any images that would be pruned from the mirror registry. It also allows you to catch any errors with your image set configuration early or use the generated list of images with other tools to carry out the mirroring operation.

-   You have access to the internet to obtain the necessary container images.

-   You have installed the OpenShift CLI (`oc`).

-   You have installed the `oc-mirror` CLI plug-in.

-   You have created the image set configuration file.

1.  Run the `oc mirror` command with the `--dry-run` flag to perform a dry run:

        $ oc mirror --config=./imageset-config.yaml \
          docker://registry.example:5000            \
          --dry-run                                  

    -   Pass in the image set configuration file that was created. This procedure assumes that it is named `imageset-config.yaml`.

    -   Specify the mirror registry. Nothing is mirrored to this registry as long as you use the `--dry-run` flag.

    -   Use the `--dry-run` flag to generate the dry run artifacts and not an actual image set file.

    **Example output**

        Checking push permissions for registry.example:5000
        Creating directory: oc-mirror-workspace/src/publish
        Creating directory: oc-mirror-workspace/src/v2
        Creating directory: oc-mirror-workspace/src/charts
        Creating directory: oc-mirror-workspace/src/release-signatures
        No metadata detected, creating new workspace
        wrote mirroring manifests to oc-mirror-workspace/operators.1658342351/manifests-redhat-operator-index

        ...

        info: Planning completed in 31.48s
        info: Dry run complete
        Writing image mapping to oc-mirror-workspace/mapping.txt

2.  Navigate into the workspace directory that was generated:

        $ cd oc-mirror-workspace/

3.  Review the `mapping.txt` file that was generated.

    This file contains a list of all images that would be mirrored.

4.  Review the `pruning-plan.json` file that was generated.

    This file contains a list of all images that would be pruned from the mirror registry when the image set is published.

    The `pruning-plan.json` file is only generated if your oc-mirror command points to your mirror registry and there are images to be pruned.

# Image set configuration parameters

The oc-mirror plug-in requires an image set configuration file that defines what images to mirror. The following table lists the available parameters for the `ImageSetConfiguration` resource.

<table><caption><code>ImageSetConfiguration</code> parameters</caption><colgroup><col style="width: 40%" /><col style="width: 40%" /><col style="width: 20%" /></colgroup><thead><tr class="header"><th style="text-align: left;">Parameter</th><th style="text-align: left;">Description</th><th style="text-align: left;">Values</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><p><code>apiVersion</code></p></td><td style="text-align: left;"><p>The API version for the <code>ImageSetConfiguration</code> content.</p></td><td style="text-align: left;"><p>String. For example: <code>mirror.openshift.io/v1alpha2</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>archiveSize</code></p></td><td style="text-align: left;"><p>The maximum size, in GiB, of each archive file within the image set.</p></td><td style="text-align: left;"><p>Integer. For example: <code>4</code></p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror</code></p></td><td style="text-align: left;"><p>The configuration of the image set.</p></td><td style="text-align: left;"><p>Object</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.additionalImages</code></p></td><td style="text-align: left;"><p>The additional images configuration of the image set.</p></td><td style="text-align: left;"><p>Array of objects. For example:</p><div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">additionalImages</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> registry.redhat.io/ubi8/ubi:latest</span></span></code></pre></div></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.additionalImages.name</code></p></td><td style="text-align: left;"><p>The tag or digest of the image to mirror.</p></td><td style="text-align: left;"><p>String. For example: <code>registry.redhat.io/ubi8/ubi:latest</code></p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.blockedImages</code></p></td><td style="text-align: left;"><p>The full tag, digest, or pattern of images to block from mirroring.</p></td><td style="text-align: left;"><p>Array of strings. For example: <code>docker.io/library/alpine</code></p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.helm</code></p></td><td style="text-align: left;"><p>The helm configuration of the image set. Note that the oc-mirror plug-in supports only helm charts that do not require user input when rendered.</p></td><td style="text-align: left;"><p>Object</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.helm.local</code></p></td><td style="text-align: left;"><p>The local helm charts to mirror.</p></td><td style="text-align: left;"><p>Array of objects. For example:</p><div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> podinfo</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">path</span><span class="kw">:</span><span class="at"> /test/podinfo-5.0.0.tar.gz</span></span></code></pre></div></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.helm.local.name</code></p></td><td style="text-align: left;"><p>The name of the local helm chart to mirror.</p></td><td style="text-align: left;"><p>String. For example: <code>podinfo</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.helm.local.path</code></p></td><td style="text-align: left;"><p>The path of the local helm chart to mirror.</p></td><td style="text-align: left;"><p>String. For example: <code>/test/podinfo-5.0.0.tar.gz</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.helm.repositories</code></p></td><td style="text-align: left;"><p>The remote helm repositories to mirror from.</p></td><td style="text-align: left;"><p>Array of objects. For example:</p><div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">repositories</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> podinfo</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://example.github.io/podinfo</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">charts</span><span class="kw">:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> podinfo</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="fl">5.0.0</span></span></code></pre></div></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.helm.repositories.name</code></p></td><td style="text-align: left;"><p>The name of the helm repository to mirror from.</p></td><td style="text-align: left;"><p>String. For example: <code>podinfo</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.helm.repositories.url</code></p></td><td style="text-align: left;"><p>The URL of the helm repository to mirror from.</p></td><td style="text-align: left;"><p>String. For example: <code>https://example.github.io/podinfo</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.helm.repositories.charts</code></p></td><td style="text-align: left;"><p>The remote helm charts to mirror.</p></td><td style="text-align: left;"><p>Array of objects.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.helm.repositories.charts.name</code></p></td><td style="text-align: left;"><p>The name of the helm chart to mirror.</p></td><td style="text-align: left;"><p>String. For example: <code>podinfo</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.helm.repositories.charts.version</code></p></td><td style="text-align: left;"><p>The version of the named helm chart to mirror.</p></td><td style="text-align: left;"><p>String. For example: <code>5.0.0</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.operators</code></p></td><td style="text-align: left;"><p>The Operators configuration of the image set.</p></td><td style="text-align: left;"><p>Array of objects. For example:</p><div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">operators</span><span class="kw">:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">catalog</span><span class="kw">:</span><span class="at"> registry.redhat.io/redhat/redhat-operator-index:v4.11</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">packages</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> elasticsearch-operator</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">minVersion</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;2.4.0&#39;</span></span></code></pre></div></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.operators.catalog</code></p></td><td style="text-align: left;"><p>The Operator catalog to include in the image set.</p></td><td style="text-align: left;"><p>String. For example: <code>registry.redhat.io/redhat/redhat-operator-index:v4.11</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.operators.full</code></p></td><td style="text-align: left;"><p>When <code>true</code>, downloads the full catalog, Operator package, or Operator channel.</p></td><td style="text-align: left;"><p>Boolean. The default value is <code>false</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.operators.packages</code></p></td><td style="text-align: left;"><p>The Operator packages configuration.</p></td><td style="text-align: left;"><p>Array of objects. For example:</p><div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">operators</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">catalog</span><span class="kw">:</span><span class="at"> registry.redhat.io/redhat/redhat-operator-index:v4.11</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">packages</span><span class="kw">:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> elasticsearch-operator</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">minVersion</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;5.2.3-31&#39;</span></span></code></pre></div></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.operators.packages.name</code></p></td><td style="text-align: left;"><p>The Operator package name to include in the image set</p></td><td style="text-align: left;"><p>String. For example: <code>elasticsearch-operator</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.operators.packages.channels</code></p></td><td style="text-align: left;"><p>The Operator package channel configuration.</p></td><td style="text-align: left;"><p>Object</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.operators.packages.channels.name</code></p></td><td style="text-align: left;"><p>The Operator channel name, unique within a package, to include in the image set.</p></td><td style="text-align: left;"><p>String. For example: <code>fast</code> or <code>stable-v4.11</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.operators.packages.channels.maxVersion</code></p></td><td style="text-align: left;"><p>The highest version of the Operator mirror across all channels in which it exists.</p></td><td style="text-align: left;"><p>String. For example: <code>5.2.3-31</code></p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.operators.packages.channels.minBundle</code></p></td><td style="text-align: left;"><p>The name of the minimum bundle to include, plus all bundles in the upgrade graph to the channel head. Set this field only if the named bundle has no semantic version metadata.</p></td><td style="text-align: left;"><p>String. For example: <code>bundleName</code></p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.operators.packages.channels.minVersion</code></p></td><td style="text-align: left;"><p>The lowest version of the Operator to mirror across all channels in which it exists.</p></td><td style="text-align: left;"><p>String. For example: <code>5.2.3-31</code></p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.operators.packages.maxVersion</code></p></td><td style="text-align: left;"><p>The highest version of the Operator to mirror across all channels in which it exists.</p></td><td style="text-align: left;"><p>String. For example: <code>5.2.3-31</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.operators.packages.minVersion</code></p></td><td style="text-align: left;"><p>The lowest version of the Operator to mirror across all channels in which it exists.</p></td><td style="text-align: left;"><p>String. For example: <code>5.2.3-31</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.operators.skipDependencies</code></p></td><td style="text-align: left;"><p>If <code>true</code>, dependencies of bundles are not included.</p></td><td style="text-align: left;"><p>Boolean. The default value is <code>false</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.operators.targetName</code></p></td><td style="text-align: left;"><p>Optional alternative name to mirror the referenced catalog as.</p></td><td style="text-align: left;"><p>String. For example: <code>my-operator-catalog</code></p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.operators.targetTag</code></p></td><td style="text-align: left;"><p>Optional alternative tag to append to the <code>targetName</code>.</p></td><td style="text-align: left;"><p>String. For example: <code>v1</code></p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.platform</code></p></td><td style="text-align: left;"><p>The platform configuration of the image set.</p></td><td style="text-align: left;"><p>Object</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.platform.architecture</code></p></td><td style="text-align: left;"><p>The architecture of the platform release payload to mirror.</p></td><td style="text-align: left;"><p>Array of strings. For example:</p><div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">architectures</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> amd64</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> arm64</span></span></code></pre></div></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.platform.channels</code></p></td><td style="text-align: left;"><p>The platform channel configuration of the image set.</p></td><td style="text-align: left;"><p>Array of objects. For example:</p><div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> stable-4.10</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> stable-4.11</span></span></code></pre></div></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.platform.channels.full</code></p></td><td style="text-align: left;"><p>When <code>true</code>, sets the <code>minVersion</code> to the first release in the channel and the <code>maxVersion</code> to the last release in the channel.</p></td><td style="text-align: left;"><p>Boolean. The default value is <code>false</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.platform.channels.name</code></p></td><td style="text-align: left;"><p>The name of the release channel.</p></td><td style="text-align: left;"><p>String. For example: <code>stable-4.11</code></p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.platform.channels.minVersion</code></p></td><td style="text-align: left;"><p>The minimum version of the referenced platform to be mirrored.</p></td><td style="text-align: left;"><p>String. For example: <code>4.9.6</code></p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.platform.channels.maxVersion</code></p></td><td style="text-align: left;"><p>The highest version of the referenced platform to be mirrored.</p></td><td style="text-align: left;"><p>String. For example: <code>4.11.1</code></p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.platform.channels.shortestPath</code></p></td><td style="text-align: left;"><p>Toggles shortest path mirroring or full range mirroring.</p></td><td style="text-align: left;"><p>Boolean. The default value is <code>false</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>mirror.platform.channels.type</code></p></td><td style="text-align: left;"><p>The type of the platform to be mirrored.</p></td><td style="text-align: left;"><p>String. For example: <code>ocp</code> or <code>okd</code>. The default is <code>ocp</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>mirror.platform.graph</code></p></td><td style="text-align: left;"><p>Indicates whether the OSUS graph is added to the image set and subsequently published to the mirror.</p></td><td style="text-align: left;"><p>Boolean. The default value is <code>false</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>storageConfig</code></p></td><td style="text-align: left;"><p>The back-end configuration of the image set.</p></td><td style="text-align: left;"><p>Object</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>storageConfig.local</code></p></td><td style="text-align: left;"><p>The local back-end configuration of the image set.</p></td><td style="text-align: left;"><p>Object</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>storageConfig.local.path</code></p></td><td style="text-align: left;"><p>The path of the directory to contain the image set metadata.</p></td><td style="text-align: left;"><p>String. For example: <code>./path/to/dir/</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>storageConfig.registry</code></p></td><td style="text-align: left;"><p>The registry back-end configuration of the image set.</p></td><td style="text-align: left;"><p>Object</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>storageConfig.registry.imageURL</code></p></td><td style="text-align: left;"><p>The back-end registry URI. Can optionally include a namespace reference in the URI.</p></td><td style="text-align: left;"><p>String. For example: <code>quay.io/myuser/imageset:metadata</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>storageConfig.registry.skipTLS</code></p></td><td style="text-align: left;"><p>Optionally skip TLS verification of the referenced back-end registry.</p></td><td style="text-align: left;"><p>Boolean. The default value is <code>false</code>.</p></td></tr></tbody></table>

`ImageSetConfiguration` parameters

# Image set configuration examples

The following `ImageSetConfiguration` file examples show the configuration for various mirroring use cases.

**Use case: Including arbitrary images and helm charts**

The following `ImageSetConfiguration` file uses a registry storage backend and includes helm charts and an additional Red Hat Universal Base Image (UBI).

**Example `ImageSetConfiguration` file**

    apiVersion: mirror.openshift.io/v1alpha2
    kind: ImageSetConfiguration
    archiveSize: 4
    storageConfig:
     registry:
       imageURL: example.com/mirror/oc-mirror-metadata
       skipTLS: false
    mirror:
     platform:
       architectures:
         - "s390x"
       channels:
         - name: stable-4.11
     operators:
       - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.11
     helm:
       repositories:
         - name: redhat-helm-charts
           url: https://raw.githubusercontent.com/redhat-developer/redhat-helm-charts/master
           charts:
             - name: ibm-mongodb-enterprise-helm
               version: 0.2.0
     additionalImages:
       - name: registry.redhat.io/ubi8/ubi:latest

**Use case: Including Operator versions from a minimum to the latest**

The following `ImageSetConfiguration` file uses a local storage backend and includes only the Red Hat Advanced Cluster Security for Kubernetes Operator, versions starting at 3.68.0 and later in the `latest` channel.

**Example `ImageSetConfiguration` file**

    apiVersion: mirror.openshift.io/v1alpha2
    kind: ImageSetConfiguration
    storageConfig:
      local:
        path: /home/user/metadata
    mirror:
      operators:
        - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.11
          packages:
            - name: rhacs-operator
              channels:
              - name: latest
                minVersion: 3.68.0

**Use case: Including the shortest {product-title} upgrade path**

The following `ImageSetConfiguration` file uses a local storage backend and includes all {product-title} versions along the shortest upgrade path from the minimum version of `4.9.37` to the maximum version of `4.10.22`.

**Example `ImageSetConfiguration` file**

    apiVersion: mirror.openshift.io/v1alpha2
    kind: ImageSetConfiguration
    storageConfig:
      local:
        path: /home/user/metadata
    mirror:
      platform:
        channels:
          - name: stable-4.10
            minVersion: 4.9.37
            maxVersion: 4.10.22
            shortestPath: true

**Use case: Including all versions of {product-title} from a minimum to the latest**

The following `ImageSetConfiguration` file uses a registry storage backend and includes all {product-title} versions starting at a minimum version of `4.10.10` to the latest version in the channel.

On every invocation of oc-mirror with this image set configuration, the latest release of the `stable-4.10` channel is evaluated, so running oc-mirror at regular intervals ensures that you automatically receive the latest releases of {product-title} images.

**Example `ImageSetConfiguration` file**

    apiVersion: mirror.openshift.io/v1alpha2
    kind: ImageSetConfiguration
    storageConfig:
     registry:
       imageURL: example.com/mirror/oc-mirror-metadata
       skipTLS: false
    mirror:
      platform:
        channels:
          - name: stable-4.10
            minVersion: 4.10.10

**Use case: Including Operator versions from a minimum to a maximum**

The following `ImageSetConfiguration` file uses a local storage backend and includes only an example Operator, versions starting at `1.0.0` through `2.0.0` in the `stable` channel.

This allows you to only mirror a specific version range of a particular Operator. As time progresses, you can use these settings to adjust the version to newer releases, for example when you no longer have version `1.0.0` running anywhere anymore. In this scenario, you can increase the `minVersion` to something newer, for example `1.5.0`. When oc-mirror runs again with the updated version range, it automatically detects that any releases older than `1.5.0` are no longer required and deletes those from the registry to conserve storage space.

**Example `ImageSetConfiguration` file**

    apiVersion: mirror.openshift.io/v1alpha2
    kind: ImageSetConfiguration
    storageConfig:
      local:
        path: /home/user/metadata
    mirror:
      operators:
        - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.10
          packages:
            - name: example-operator
              channels:
                - name: stable
                  minVersion: '1.0.0'
                  maxVersion: '2.0.0'

# Command reference for oc-mirror

The following tables describe the `oc mirror` subcommands and flags:

<table><caption>oc mirror subcommands</caption><colgroup><col style="width: 33%" /><col style="width: 66%" /></colgroup><thead><tr class="header"><th style="text-align: left;">Subcommand</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><p><code>completion</code></p></td><td style="text-align: left;"><p>Generate the autocompletion script for the specified shell.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>describe</code></p></td><td style="text-align: left;"><p>Output the contents of an image set.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>help</code></p></td><td style="text-align: left;"><p>Show help about any subcommand.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>init</code></p></td><td style="text-align: left;"><p>Output an initial image set configuration template.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>list</code></p></td><td style="text-align: left;"><p>List available platform and Operator content and their version.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>version</code></p></td><td style="text-align: left;"><p>Output the oc-mirror version.</p></td></tr></tbody></table>

oc mirror subcommands

<table><caption>oc mirror flags</caption><colgroup><col style="width: 33%" /><col style="width: 66%" /></colgroup><thead><tr class="header"><th style="text-align: left;">Flag</th><th style="text-align: left;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;"><p><code>-c</code>, <code>--config</code> <code>&lt;string&gt;</code></p></td><td style="text-align: left;"><p>Specify the path to an image set configuration file.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>--continue-on-error</code></p></td><td style="text-align: left;"><p>If any non image-pull related error occurs, continue and attempt to mirror as much as possible.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>--dest-skip-tls</code></p></td><td style="text-align: left;"><p>Disable TLS validation for the target registry.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>--dest-use-http</code></p></td><td style="text-align: left;"><p>Use plain HTTP for the target registry.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>--dry-run</code></p></td><td style="text-align: left;"><p>Print actions without mirroring images. Generates <code>mapping.txt</code> and <code>pruning-plan.json</code> files.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>--from &lt;string&gt;</code></p></td><td style="text-align: left;"><p>Specify the path to an image set archive that was generated by an execution of oc-mirror to load into a target registry.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>-h</code>, <code>--help</code></p></td><td style="text-align: left;"><p>Show the help.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>--ignore-history</code></p></td><td style="text-align: left;"><p>Ignore past mirrors when downloading images and packing layers. Disables incremental mirroring and might download more data.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>--manifests-only</code></p></td><td style="text-align: left;"><p>Generate manifests for <code>ImageContentSourcePolicy</code> and <code>CatalogSource</code> objects to configure a cluster to use the mirror registry, but do not actually mirror any images.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>--max-per-registry &lt;int&gt;</code></p></td><td style="text-align: left;"><p>Specify the number of concurrent requests allowed per registry. The default is <code>6</code>.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>--skip-cleanup</code></p></td><td style="text-align: left;"><p>Skip removal of artifact directories.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>--skip-image-pin</code></p></td><td style="text-align: left;"><p>Do not replace image tags with digest pins in Operator catalogs.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>--skip-metadata-check</code></p></td><td style="text-align: left;"><p>Skip metadata when publishing an image set. This is only recommended when the image set was created with <code>--ignore-history</code>.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>--skip-missing</code></p></td><td style="text-align: left;"><p>If an image is not found, skip it instead of reporting an error and aborting execution. Does not apply to custom images explicitly specified in the image set configuration.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>--skip-verification</code></p></td><td style="text-align: left;"><p>Skip digest verification.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>--source-skip-tls</code></p></td><td style="text-align: left;"><p>Disable TLS validation for the source registry.</p></td></tr><tr class="odd"><td style="text-align: left;"><p><code>--source-use-http</code></p></td><td style="text-align: left;"><p>Use plain HTTP for the source registry.</p></td></tr><tr class="even"><td style="text-align: left;"><p><code>-v</code>, <code>--verbose</code> <code>&lt;int&gt;</code></p></td><td style="text-align: left;"><p>Specify the number for the log level verbosity. Valid values are <code>0</code> - <code>9</code>. The default is <code>0</code>.</p></td></tr></tbody></table>

oc mirror flags
